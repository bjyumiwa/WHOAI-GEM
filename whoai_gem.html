<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title data-i18n="title">WHOAI Gem</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body,html{
      margin:0;padding:0;overflow:hidden;height:100%;
      font-family:sans-serif;background:#000;color:#fff;
      touch-action:none; /* スクロール防止（スマホ用） */
    }
    .bg{
      position:absolute;top:0;left:0;width:100%;height:100%;
      background-size:cover;background-position:center;
      transition:opacity 1s;
    }
    .hide{opacity:0;pointer-events:none}

    .whoai{
      position:absolute;
      bottom:12vh;left:5vw;
      width:clamp(80px,12vw,140px);
      animation:hop 2s infinite;
      user-select:none;
    }
    @keyframes hop{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}

    .bucket{
      position:absolute;
      right:2vw;bottom:6vh;
      width:clamp(72px,14vw,160px);
      user-select:none;
    }
    .bucket img{display:block;width:100%;height:auto}

    #counter{
      position:absolute;
      right:calc(2vw + 40px); bottom:calc(6vh + 40px);
      font-size:clamp(16px,2vw,24px);
      background:#fff;color:#111;
      padding:6px 12px;border-radius:50%;
      text-align:center;
    }

    .ui{
      position:absolute;bottom:10px;left:50%;
      transform:translateX(-50%);
      display:flex;gap:6px;z-index:10
    }
    .ui button{
      padding:6px 10px;border-radius:12px;border:none;cursor:pointer
    }

    #toast{
      position:absolute;top:10px;left:10px;
      background:rgba(0,0,0,0.6);
      padding:6px 12px;border-radius:6px;
      z-index:10
    }

    #langSel{position:absolute;top:10px;right:10px;z-index:10}

    .shell{
      position:absolute;width:60px;height:60px;
      background-size:contain;background-repeat:no-repeat;
      background-position:center;
      cursor:grab;user-select:none;
      touch-action:none;
    }

    .speech{
      position:absolute;
      background:#fff;color:#000;
      padding:4px 8px;border-radius:8px;
      font-size:14px;
      transform:translate(-50%,-100%);
      white-space:nowrap;
      animation:fadeout 2s forwards;
    }
    @keyframes fadeout{
      0%{opacity:1;transform:translate(-50%,-100%)}
      100%{opacity:0;transform:translate(-50%,-150%)}
    }
  </style>
</head>
<body>
  <!-- 背景 -->
  <div id="bg-sunrise" class="bg" style="background-image:url('./public/bg/sunrise.jpg')"></div>
  <div id="bg-beach"   class="bg hide" style="background-image:url('./public/bg/beach_day.jpg')"></div>
  <div id="bg-night"   class="bg hide" style="background-image:url('./public/bg/night_beach.jpg')"></div>

  <!-- WHOAIキャラ -->
  <img id="whoai" class="whoai" src="./assets/stage1/green_open.png" alt="whoai">

  <!-- バケツ -->
  <div class="bucket"><img id="bucketImg" src="./public/bucket.png.png" alt="bucket"></div>
  <div id="counter">0</div>

  <!-- UI -->
  <div id="toast"></div>
  <div class="ui">
    <button id="btnStart" data-i18n="btn.start">はじめる</button>
    <button id="btnCook" data-i18n="btn.cook">料理</button>
    <button id="btnAcc"  data-i18n="btn.acc">アクセサリー</button>
    <button id="btnCol"  data-i18n="btn.col">コレクション</button>
    <button id="btnNight" data-i18n="btn.night">夜へ</button>
  </div>
  <select id="langSel" aria-label="language">
    <option value="ja">日本語</option>
    <option value="en">English</option>
    <option value="ko">한국어</option>
    <option value="zh">中文</option>
  </select>

<script>
/* i18n（シンプル版） */
const I18N = {
  ja:{
    "title":"WHOAI Gem",
    "toast.sunrise":"おはよう。朝日がきれいだね",
    "toast.beach":"砂をやさしくなでてみよう",
    "toast.night":"今日はここまでにしようか",
    "btn.start":"はじめる","btn.cook":"料理","btn.acc":"アクセサリー","btn.col":"コレクション","btn.night":"夜へ"
  },
  en:{
    "title":"WHOAI Gem",
    "toast.sunrise":"Good morning, the sunrise is beautiful",
    "toast.beach":"Gently stroke the sand",
    "toast.night":"Shall we call it a day?",
    "btn.start":"Start","btn.cook":"Cook","btn.acc":"Accessory","btn.col":"Collection","btn.night":"Night"
  }
};
let curLang="ja";
function t(key){return I18N[curLang][key]||key;}
function applyI18n(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    el.textContent=t(el.dataset.i18n);
  });
}
document.getElementById("langSel").onchange=e=>{
  curLang=e.target.value;applyI18n();showToast("toast.sunrise");
};

/* UI */
const toast=document.getElementById("toast");
function showToast(key){toast.textContent=t(key);}

/* 状態 */
let count=0;
let shells=[];

/* 背景切替 */
function showScene(id,msg){
  document.querySelectorAll(".bg").forEach(bg=>bg.classList.add("hide"));
  document.getElementById(id).classList.remove("hide");
  showToast(msg);
}

/* 貝配置 */
const COMMON=[
  "./public/items/asari1.png","./public/items/asari2.png","./public/items/asari3.png"
];
const RARE=[
  "./public/items/aurora_shell.png","./public/items/flame_shell.png","./public/items/luminous_shell.png",
  "./public/items/mystic_shell.png","./public/items/night_sky_shell.png",
  "./public/items/rare_pearl.png","./public/items/rare_rainbow.png","./public/items/wave_shell.png"
];

function spawnShell(){
  const img = (Math.random()<0.7?COMMON:RARE)[Math.floor(Math.random()*3)];
  const shell=document.createElement("div");
  shell.className="shell";
  shell.style.backgroundImage=`url(${img})`;
  shell.style.left=Math.random()*70+10+"%";
  shell.style.top=Math.random()*50+40+"%";
  document.body.appendChild(shell);
  shells.push(shell);

  makeDraggable(shell);
}

/* ドラッグ処理 */
function makeDraggable(el){
  let offsetX,offsetY,dragging=false;

  function onDown(e){
    dragging=true;
    offsetX=(e.touches?e.touches[0].clientX:e.clientX)-el.offsetLeft;
    offsetY=(e.touches?e.touches[0].clientY:e.clientY)-el.offsetTop;
    e.preventDefault();
  }
  function onMove(e){
    if(!dragging)return;
    const x=(e.touches?e.touches[0].clientX:e.clientX)-offsetX;
    const y=(e.touches?e.touches[0].clientY:e.clientY)-offsetY;
    el.style.left=x+"px";el.style.top=y+"px";
  }
  function onUp(e){
    if(!dragging)return;dragging=false;
    const bucket=document.getElementById("bucketImg").getBoundingClientRect();
    const shell=el.getBoundingClientRect();
    if(shell.left<bucket.right && shell.right>bucket.left &&
       shell.top<bucket.bottom && shell.bottom>bucket.top){
      el.remove();
      count++;
      document.getElementById("counter").textContent=count;
      // 吹き出し
      const whoai=document.getElementById("whoai");
      const rect=whoai.getBoundingClientRect();
      const sp=document.createElement("div");
      sp.className="speech";sp.textContent="やったね！";
      sp.style.left=(rect.left+rect.width/2)+"px";
      sp.style.top=rect.top+"px";
      document.body.appendChild(sp);
      setTimeout(()=>sp.remove(),2000);
    }
  }
  el.addEventListener("mousedown",onDown);
  el.addEventListener("touchstart",onDown,{passive:false});
  window.addEventListener("mousemove",onMove);
  window.addEventListener("touchmove",onMove,{passive:false});
  window.addEventListener("mouseup",onUp);
  window.addEventListener("touchend",onUp);
}

/* キャラで砂をなでる演出（簡易） */
document.getElementById("whoai").addEventListener("mousedown",()=>showToast("toast.beach"));
document.getElementById("whoai").addEventListener("touchstart",()=>showToast("toast.beach"));

/* ボタン */
document.getElementById("btnStart").onclick=()=>{
  showScene("bg-sunrise","toast.sunrise");
  spawnShell();
};
document.getElementById("btnCook").onclick=()=>alert("料理シーンへ");
document.getElementById("btnAcc").onclick=()=>alert("アクセサリーシーンへ");
document.getElementById("btnCol").onclick=()=>alert("コレクションシーンへ");
document.getElementById("btnNight").onclick=()=>showScene("bg-night","toast.night");

/* 初期化 */
applyI18n();
showScene("bg-sunrise","toast.sunrise");
</script>
</body>
</html>
